[TOC]

# 网络层协议

## 概述与约定

### 概述

+ 网络层是OSI模型中的第三层。网络层提供**转发(forwading)、路由(routing)和寻址(addressing)**的功能，使两终端系统能够互连且**决定最佳路径**，并具有一定的**拥塞控制**和**流量控制**的能力。TCP/IP协议体系中的**网络层功能由IP协议规定和实现，故又称IP层**。

### 具有网络层功能的协议

+ IP      **网际协议** 		      **I**nternet **P**rotocol
  + 根据源主机和目的主机的地址传送数据。
  + 定义了寻址方法和数据报的封装结构。
  + 第一个架构的主要版本，现在称为IPv4，仍是最主要的互联网协议。
+ IPX    **互联网分组交换协议**  **I**nternetwork **P**acket E**x**change
  + IPX的地址分为网络地址和主机地址，网络地址由管理员分配，主机地址为MAC地址。
  + 由于IP协议的广泛使用，IPX的应用逐渐减少。
+ X.25
  + X.25 是一个使用电话或者ISDN设备作为网络硬件设备来架构广域网的ITU-T网络协议。在
  + 国际上X.25的提供者通常称X.25为分封交换网，尤其是那些国营的电话公司。
  + 在现在仍然应用于交易系统中。
+ ARP   **地址解析协议**         **A**ddress **R**esolution **P**rotocol
  + 基本功能为透过目标设备的IP地址，查询目标设备的MAC地址，以保证通信的顺利进行。
  + 它是IPv4中网络层必不可少的协议，在IPv6中已不再适用，并被邻居发现协议（NDP）所替代。
+ RARP **逆地址解析协议**     **R**everse **A**ddress **R**esolution **P**rotocol
  + RARP使用与ARP相同的报头结构，作用与ARP相反。
  + RARP用于将MAC地址转换为IP地址。
  + 其因为较限于IP地址的运用以及其他的一些缺点，因此渐为更新的BOOTP或DHCP所替换。
+ ICMP  网络控制消息协定  **I**nternet **C**ontrol **M**essage **P**rotocol
  + 网路协议族的核心协议之一。它用于TCP/IP网络中发送控制消息，提供可能发生在通信环境中的各种问题反馈，通过这些信息，令管理者可以对所发生的问题作出诊断，然后采取适当的措施解决。
  + ICMP 依靠IP来完成它的任务，**它是IP的主要部分**。
  + 它与传输协议，如TCP和UDP显著不同：它一般不用于在两点间传输数据。它通常不由网络程序直接使用，除了ping和traceroute这两个特别的例子。
  + IPv4中的ICMP被称作ICMPv4，IPv6中的ICMP则被称作ICMPv6。

### 具有网络层功能的设备

+ 路由器（Router）
+ 三层交换机（Layer 3 Switch）


### 网络层功能：转发和路由选择

+ 转发：（驾车通过单个立交桥的过程）
  1. 分组到达路由器输入链路
  2. 路由器根据分组的首部查询**转发表**
  3. 路由器将分组送到合适的输出链路
+ 路由选择：（旅游驾驶路线）
  1. 分组从输出链路出发
  2. 网络层决定向哪台路由器出发（**路由选择算法**）
  3. 分组流向接收方
+ 连接建立：有些网络层体系如ATM、帧中继、MPLS要求源到目的地沿着路径握手。

### 网络层服务模型

+ 确保交付
+ 限制时延的确保交付
+ 有序分组交付
+ 确保最小带宽
+ 确保最大时延抖动
+ 安全性服务
+ .......

网络层提供的服务是**尽力而为服务**，看起来就和**根本无服务**没区别，但是却有着存在的意义。

## 虚电路和数据报网络

### 概述

+ 在网络层提供有连接的服务的计算机网络称为虚电路网络
+ 在网络层提供无连接的服务的计算机网络称为数据报网络

### 虚电路网络

#### 组成

1. 源主机和目的主机之间的路径（链路和路由器）
2. VC号，即沿着该路径的每段链路的一个号码
   + 在传播过程中，包的VC号随着到达的每一个路由器根据转发表更新。
3. 沿着该路径的每个路由器中的转发表表项

#### 特点

+ 新建虚电路的过程就是在转发表中添加VC号转换规则的过程，反之就是拆除虚电路的过程。
+ 路由器有维护虚电路状态信息的义务，因为虚电路是面向连接的。
+ 每一次连接都要经历新建、传输、拆除的过程。

### 数据报网络

+ 无需任何虚电路，也没必要维护状态

+ 数据报网络中的路由器根据**地址前缀匹配规则**来转发分组，并且是最长匹配原则。

  相应的转发表就是这么制定的。

## 路由器工作原理



